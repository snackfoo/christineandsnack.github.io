(function(a){$scope={},AstraImageCommon={images:{},image:{},action:'',offset:0,loadingStatus:!0,config:{q:'',lang:'en',image_type:'all',orientation:'all',category:'',min_width:0,min_height:0,colors:'',editors_choice:!1,safesearch:!0,order:'popular',page:a('body').data('page'),per_page:30,callback:'',pretty:!0},canSave:!1,infiniteLoad:!1,uploader:{},file:{},frame:{},isPreview:!1,apiStatus:!0,id:'',isValidating:!1,scopeSet:!1,init:function(){this._bind()},_bind:function(){a(document).on("ast-image__refresh",AstraImageCommon._initImages),a(document).on("ast-image__set-scope",AstraImageCommon._setScope),a(document).on("click",".ast-image__list-img-overlay",AstraImageCommon._preview),a(document).on("click",".ast-image__go-back-text",AstraImageCommon._goBack),a(document).on("click",".ast-image__save",AstraImageCommon._save),a(document).on("click",".ast-image__filter-safesearch input",AstraImageCommon._filter),a(document).on("change",".ast-image__filter select",AstraImageCommon._filter),a(document).on("click",".ast-image__edit-api",AstraImageCommon._editAPI),a(document).on("click",".ast-image__browse-images",AstraImageCommon._browse),a(document).on("click",".ast-image__download-icon",AstraImageCommon._saveFromScreen)},_saveFromScreen:function(){let b=a(this),c=b.closest('.ast-image__list-img-overlay');b.addClass('installing'),AstraImageCommon.image={largeImageURL:c.data('img-url'),tags:c.find('span:first-child').html(),id:c.data('img-id')},AstraImageCommon._saveAjax(function(a){if(void 0==a.data)return;astraImages.saved_images=a.data['updated-saved-images'],wp.media.view.AstraAttachmentsBrowser.object.photoUploadComplete(a.data),b.text('Done'),b.removeClass('installing'),AstraImageCommon._empty()})},_browse:function(){$scope.find('.ast-image__search').trigger('keyup')},_editAPI:function(a){a.stopPropagation(),wp.media.view.AstraAttachmentsBrowser.images=[],$scope.find('.ast-image__loader-wrap').show(),$scope.find('.ast-image__skeleton').html(''),$scope.find('.ast-image__skeleton').attr('style',''),$scope.find('.ast-image__search').trigger('keyup'),$scope.find('.ast-image__loader-wrap').hide()},_filter:function(){let a=!!$scope.find('.ast-image__filter-safesearch input:checked').length,b=$scope.find('.ast-image__filter-category select').val(),c=$scope.find('.ast-image__filter-orientation select').val(),d=$scope.find('.ast-image__filter-order select').val();AstraImageCommon.config.safesearch=a,AstraImageCommon.config.orientation=c,AstraImageCommon.config.category=b,AstraImageCommon.config.order=d,$scope.find('.ast-image__search').trigger('keyup'),$scope.find('.ast-image__loader-wrap').show()},_save:function(){if(!AstraImageCommon.canSave)return;let b=a(this);if(b.data('import-status'))return;b.removeClass('updating-message'),b.text(astraImages.downloading),b.addClass('installing'),AstraImageCommon.canSave=!1,AstraImageCommon._saveAjax(function(a){if(void 0==a.data)return;astraImages.saved_images=a.data['updated-saved-images'],wp.media.view.AstraAttachmentsBrowser.object.photoUploadComplete(a.data),b.text('Done'),b.removeClass('installing'),AstraImageCommon._empty()})},_saveAjax:function(b){a.ajax({url:astraImages.ajaxurl,type:'POST',dataType:'json',data:{action:'astra-sites-create-image',url:AstraImageCommon.image.largeImageURL,name:AstraImageCommon.image.tags,id:AstraImageCommon.image.id,_ajax_nonce:astraImages._ajax_nonce}}).fail(function(a){console.log(a)}).done(b)},_empty:function(){AstraImageCommon.image={},AstraImageCommon.canSave=!1,AstraImageCommon.uploader={},AstraImageCommon.file={},AstraImageCommon.isPreview=!1},_goBack:function(){AstraImageCommon._empty(),a(document).trigger('ast-image__refresh'),$scope.find('.ast-image__skeleton').show(),$scope.removeClass('preview-mode'),$scope.find('.ast-attachments-search-wrap').children().show(),$scope.find('.ast-image__go-back').remove(),$scope.find('.ast-image__save-wrap').remove(),$scope.find('.ast-image__preview-skeleton').hide(),$scope.find('.ast-image__preview-skeleton').html('');let b=AstraImageCommon.offset-210;$scope.find('.ast-image__skeleton-inner-wrap').css('height',b)},_preview:function(c){if(c&&c.target.classList.contains('ast-image__download-icon'))return;AstraImageCommon.isPreview=!0;let d=AstraImageCommon.offset-190;$scope.find('.ast-image__skeleton-inner-wrap').css('height',d),setTimeout(function(){$scope.find('.ast-image__loader-wrap').hide()},200),AstraImageCommon.image={largeImageURL:a(this).data('img-url'),tags:a(this).find('span:first-child').html(),id:a(this).data('img-id')};let e=wp.template('ast-image-single'),f=e(AstraImageCommon.image),g=wp.template('ast-image-save'),h=g(AstraImageCommon.image),b=$scope.find('.ast-image__skeleton-inner-wrap').outerHeight();b=b-60,$scope.find('.ast-image__skeleton').hide(),$scope.addClass('preview-mode'),$scope.find('.ast-attachments-search-wrap').children().hide(),$scope.find('.ast-image__search-wrap').before(a('#tmpl-ast-image-go-back').text()),$scope.find('.ast-image__search-wrap').after(h),$scope.find('.ast-image__preview-skeleton').html(f),$scope.find('.ast-image__preview-skeleton').show(),$scope.find('.single-site-preview').css('max-height',b),AstraImageCommon.canSave=!0},_setScope:function(){if(AstraImageCommon.frame=wp.media.view.AstraAttachmentsBrowser.object.$el.closest('.media-frame'),$scope=AstraImageCommon.frame.find('.ast-attachments-browser'),void 0==$scope)return;a('body').data('page',1);let b=a('#tmpl-ast-image-skeleton').text();$scope.append(b);let c=wp.template('ast-image-filters');$scope.find('.ast-image__filter-wrap').length||$scope.find('.ast-attachments-search-wrap').append(c()),AstraImageCommon.offset=AstraImageCommon.frame.outerHeight();let d=AstraImageCommon.offset-210;$scope.find('.ast-image__skeleton-inner-wrap').css('height',d),$scope.find('.ast-image__search').trigger('keyup'),$scope.find('.ast-image__loader-wrap').show(),$scope.find('.ast-image__skeleton-inner-wrap').scroll(AstraImageCommon._loadMore),AstraImageCommon.scopeSet=!0},_initImages:function(){let c=wp.template('ast-image-list'),b=c(wp.media.view.AstraAttachmentsBrowser.images),d=document.querySelector('.ast-image__skeleton');$scope.find('.ast-image__loader-wrap').show(),AstraImageCommon.infiniteLoad?(AstraImageCommon.images.push(wp.media.view.AstraAttachmentsBrowser.images),$scope.find('.ast-image__skeleton').append(b)):(AstraImageCommon.images=wp.media.view.AstraAttachmentsBrowser.images,$scope.find('.ast-image__skeleton').html(b)),AstraImageCommon.loadingStatus=!0,$scope.find('.ast-image__list-wrap').length?imagesLoaded(d,function(){$scope.find('.ast-image__list-wrap').each(function(b){a(this).removeClass('loading'),a(this).addClass('loaded')}),$scope.find('.ast-image__loader-wrap').hide()}):$scope.find('.ast-image__loader-wrap').hide()},_loadMore:function(){if(AstraImageCommon.isPreview)return;let b=a('body').data('page');b=void 0==b?2:b+1,void 0!=$scope.find('.ast-image__list-wrap:last').offset()&&a(window).scrollTop()+AstraImageCommon.offset>=$scope.find('.ast-image__list-wrap:last').offset().top&&AstraImageCommon.loadingStatus&&($scope.find('.ast-image__loader-wrap').show(),AstraImageCommon.loadingStatus=!1,AstraImageCommon.infiniteLoad=!0,AstraImageCommon.config.page=b,a('body').data('page',b),$scope.find('.ast-image__search').trigger('infinite'))}},a(function(){AstraImageCommon.init()})})(jQuery)